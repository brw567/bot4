global
    maxconn 4096
    log stdout local0
    
defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    
# API Load Balancing
frontend api_frontend
    bind *:8080
    default_backend api_backend
    
backend api_backend
    balance roundrobin
    option httpchk GET /health/readiness
    server node1 trading-engine-1:8080 check
    server node2 trading-engine-2:8080 check
    server node3 trading-engine-3:8080 check
    
# Metrics Aggregation
frontend metrics_frontend
    bind *:9090
    default_backend metrics_backend
    
backend metrics_backend
    balance roundrobin
    server node1 trading-engine-1:9090
    server node2 trading-engine-2:9090
    server node3 trading-engine-3:9090
    
# gRPC Load Balancing
frontend grpc_frontend
    bind *:50051
    mode tcp
    default_backend grpc_backend
    
backend grpc_backend
    mode tcp
    balance roundrobin
    server node1 trading-engine-1:50051 check
    server node2 trading-engine-2:50051 check
    server node3 trading-engine-3:50051 check